<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}APP-PVO{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  {% load static %}
  <!-- Favicon -->
  <link rel="icon" href="{% static 'img/icono.ico' %}" type="image/x-icon">

  <!-- Tabler CSS -->
  <link href="https://unpkg.com/@tabler/core@latest/dist/css/tabler.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="{% static 'css/estilos.css' %}">
  <script src="https://unpkg.com/htmx.org@1.9.6"></script>

  <style>
    .navbar-brand img {
      height: 40px; /* Controla el alto del logo */
      width: auto;  /* Mantiene la proporci√≥n */
    }

    @media (max-width: 768px) {
      .navbar-brand img {
        height: 30px; /* Un poco m√°s peque√±o en m√≥viles */
      }
    }
  </style>
</head>
<body>

{% if not request.htmx %}
<!-- Navbar superior -->
<header class="navbar navbar-expand-md navbar-dark bg-dark">
  <div class="container-xl d-flex justify-content-between align-items-center">
    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="{% url 'dashboard' %}">
      <img src="{% static 'img/gb.png' %}" alt="APP-PVO Logo" class="me-2">
      <span class="fw-bold text-white">APP-PVO</span>
    </a>

    {% if user.is_authenticated %}
      <div class="d-flex align-items-center">
        <span class="text-white me-3">{{ user.username }}</span>
        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-light btn-sm">Cerrar sesi√≥n</button>
        </form>
      </div>
    {% else %}
      <a class="btn btn-outline-primary" href="{% url 'login' %}">Iniciar sesi√≥n</a>
    {% endif %}
  </div>
</header>

<!-- Men√∫ horizontal debajo -->
<div class="navbar navbar-light bg-light border-bottom">
  <div class="container-xl">
    <ul class="nav nav-pills">
      <li class="nav-item">
        <a class="nav-link" href="{% url 'query_report_view' %}">
          üìä Pedidos Activos
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'pvo_list' %}">
          üóÇÔ∏è Gesti√≥n PVO
        </a>
      </li>
    </ul>
  </div>
</div>
{% endif %}

<main class="page-wrapper">
  <div class="container-xl py-4">
    {% block content %}{% endblock %}
  </div>
</main>

<!-- Tabler JS -->
<script src="https://unpkg.com/@tabler/core@latest/dist/js/tabler.min.js"></script>

<!-- Modal HTMX -->
<div class="modal fade" id="htmxModal" tabindex="-1" role="dialog" aria-labelledby="htmxModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" id="modal-content">
      <!-- Aqu√≠ con HTMX puedo inyectar el formulario -->
    </div>
  </div>
</div>

<script>
  document.body.addEventListener('htmx:afterSwap', (e) => {
    if (e.target.id === "modal-content") {
      $('#htmxModal').modal('show');
    }
  });

  document.body.addEventListener('htmx:beforeSwap', (e) => {
    if (e.detail.xhr.status === 204) {
      $('#htmxModal').modal('hide');
      e.detail.shouldSwap = false;
      location.reload();
    }
  });
</script>

</body>
</html>
